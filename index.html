<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>reveal.js</title>

    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/simple.css">
    <link rel="stylesheet" href="css/custom.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/monokai.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>
</head>

<body>
    <div class="reveal">
        <div class="slides">

            <section class="black-slide">
              <h1 class="presentation-title">Headless E-Commerce <br>with <br>React and Next.js</h1>

                <aside class="notes">
                    <ul>
                    </ul>
                </aside>
            </section>

            <section>
                <h1>About Me</h1>

                <div class="about-me">
                    <span>Hi, I'm René! :)</span>
                    <span class="fragment">Web Developer</span>
                    <span class="fragment">marmalade Group</span>
                </div>

                <aside class="notes">
                    <ul>
                      <li>Kurzvorstellung marmalade -> Projektgeschäft vs. Produktentwicklung</li>
                      <li>Makaira als Grundlage für die Umsetzung des Projekts</li>
                    </ul>
                </aside>
            </section>

            <section class="black-slide">
              <h1 class="presentation-title">What is this talk about?</h1>
            </section>

            <section class="grey-slide">
              <div class="sneak-peak-wrapper">
                <img src="./graphics/spoco-sneak-peak-maincat.png" alt="">
              </div>

                <aside class="notes">
                    <ul>
                        <li>recht klassischer E-Commerce-Shop</li>
                        <li>Listenseiten mit Filtern und Sortierung</li>
                        <li>Content-lastige Seiten</li>
                        <li>Sucheergebnisseiten</li>
                        <li>...wurde entschieden, den Shop - ursprünglich ein wahrer Monolith - nun mit einem Headless-Ansatz umzusetzen</li>
                    </ul>
                </aside>
            </section>

            <section class="black-slide">
                <h1 class="presentation-title">Headless</h1>

                <aside class="notes">
                    <ul>
                      <li>Headless -> ursprünglich aus dem CMS-Bereich bekannt</li>
                      <li>Begriff taucht aber auch mehr und mehr in anderen Zusammenhängen, wie Webshops, auf</li>
                      <li>Aber was kennzeichnet "Headless Applications" überhaupt?</li>
                    </ul>
                </aside>
            </section>

            <section>
                <h5>Characteristics:</h5>
                <ul>
                    <li class="">Storefront decoupled from Backend</li>
                    <li class="fragment fade-opacity-in">State Management remains in the Backend</li>
                    <li class="fragment fade-opacity-in">Communication exclusively via APIs</li>
                </ul>

                <aside class="notes">
                    <ul>
                      <li>Frontend -> Auslieferung erfolgt nicht mehr vom "Monolithen"</li>
                      <li>State Management -> Erklärung (Warenkorb, Login-Status, etc)</li>
                      <li>APIs -> kein direkter Zugriff auf Datenbanken o.ä.</li>
                    </ul>
                </aside>
            </section>

            <section class="black-slide">
                <h1 class="presentation-title">But why?</h1>

                <aside class="notes">
                    <ul>
                        <li></li>
                    </ul>
                </aside>
            </section>

            <section>
                <h5>Benefits:</h5>
                <ul>
                    <li class="">(Re-)Use data in any application</li>
                    <li class="fragment fade-opacity-in">Gradually replace existing legacy systems</li>
                    <li class="fragment fade-opacity-in">Change your development workflows</li>
                </ul>

                <aside class="notes">
                    <ul>
                      <li>Marketing-Opportunities vs. Technology vs. Workflows change</li>
                      <li>Ausschließlich APIs -> Multi-Channel- Marketing aus einer Datenquelle</li>
                    </ul>
                </aside>
            </section>

<section class="black-slide">
                <h1 class="presentation-title">Architecture</h1>

                <aside class="notes">
                    <ul>
                        <li></li>
                    </ul>
                </aside>
            </section>

            <section class="white-slide">
                <div class="architecture-wrapper">
                    <img class="" src="./graphics/architecture_old_fragment_1.svg" alt="">
                    <img class="fragment" src="./graphics/architecture_old_fragment_2.svg" alt="">
                    <img class="fragment" src="./graphics/architecture_old_fragment_3.svg" alt="">
                </div>

                <aside class="notes">
                    <ul>
                      <li>OXID-Drawbacks (naive Suche, Filterung)</li>
                      <li>ES-Features -> Analyzing, Stemming, fuzzy searching usw.</li>
                      <li>Was noch tun mit den Daten?</li>
                    </ul>
                </aside>
            </section>

        <section class="black-slide">
                <h1 class="presentation-title">Concept #1</h1>
                <h1 class="presentation-title">API-First Workflow</h1>

                <aside class="notes">
                    <ul>
                        <li></li>
                    </ul>
                </aside>
            </section>

<section>
                <h5>In Theory:</h5>
                <ul>

                    <li class="">Frontend has no knowledge about URL structures</li>
                    <li class="fragment fade-opacity-in">API provides information related to a given URL (content, products, etc.)</li>
                    <li class="fragment fade-opacity-in">Frontend decides what kind of page to render based on the API response</li>
                </ul>

                <aside class="notes">
                    <ul>
                        <li>In theory, when using an API-first workflow, the frontend has no knowledge about the URL structures of the underlying system</li>
                        <li>Instead, the API provides all the information related to a given URL</li>
                        <li>This means that everything that is relevant to render the page of a given url is provided by the API...</li>
                        <li>...this information can range from simple content elements to whole lists of products and filters</li>
                        <li>Now, based on that API-Response the Frontend can decide what kind of page - a Landingpage, a Product List or a Product Detail page - to render</li>
                    </ul>
                </aside>
            </section>

            <section class="white-slide">
              <h5>In Practice:</h5>

                <div class="api-first-wrapper">
                    <img class="fragment" src="./graphics/api_first_success.svg" alt="">
                </div>

                <h5 class="fragment">Unknown URLs:</h5>
                <div class="api-first-wrapper api-first-wrapper--unknown">
                    <img class="fragment" src="./graphics/api_first_failure.svg" alt="">
                </div>

                <aside class="notes">
                    <ul>
                        <li>Now, how does this look like in practice?</li>
                        <li>When the load balancers receives a request, it is initilly routing it to the Next.js application</li>
                        <li>The Next.js application then generates an API request based on the URL and requests further information from Makaira</li>
                        <li>Makaira in turn looks up the URL in ElasticSearch, prepares the result if necessary and sends the response back to the Next.js application</li>
                        <li>based on that response, Next.js can now decide what kind of page to render under the given URL</li>
                        <li>So, that illustrates the successful case ...but since we do not replace all the pages of the shop, there are still URLs that need to be handled by the legacy system ...how do we achieve that split?</li>
                        <li>Well, for unknown URLs the workflow looks pretty much the same</li>
                        <li>the difference here is that Makaira will respond with a 404 status code if no result was found for the given URL</li>
                        <li>this signals to the next.js application that the URL is supposed to be handled by the legacy system</li>
                        <li>so, in turn Next.js responds with a 404 to the load balancer's request...</li>
                        <li>...and this causes the load balancer to trigger a failover mechanism which then routes the request to the legacy system where it will be handled</li>
                        <li>Not only is this mechanism necessary for the shop to still function properly, it also enabled us to migrate to the new system step by step...</li>
                    </ul>
                </aside>
            </section>

            <section class="black-slide">
                <h1 class="presentation-title">Concept #2</h1>
                <h1 class="presentation-title">URL-driven Frontend</h1>

              <aside class="notes">
                    <ul>
                      <li>URL-driven -> kein neues Konzept, aber in SPAs manchmal nicht beachtet</li>
                    </ul>
                </aside>
            </section>

            <section>
                <h5>URL-driven:</h5>
                <ul>
                  <li class=""><b>Application state</b> (filtering, sorting, ...) is derived from query parameters</li>
                    <li class="fragment fade-opacity-in"><b>Request Builder</b> generates API requests based on the Context</li>
                    <li class="fragment fade-opacity-in"><b>User interactions</b> generate new query parameters</li>
                    <li class="fragment fade-opacity-in">Navigate to the new URL to generate a new API request and fetch data</li>
                    <li class="fragment fade-opacity-in">Navigation happens internally, unnoticable for the user</li>
                </ul>

                <aside class="notes">
                    <ul>
                      <li>Request Builder -> erzeugt API-Requests aus gegebenen Informationen (query params)</li>
                      <li>Next.js -> Context mit Query params etc</li>
                      <li>User Interaction -> generiert neue URL mit query params -> immer den gleichen Zyklus</li>
                    </ul>
                </aside>
            </section>


            <section class="black-slide">
                <h1 class="presentation-title">Implementation in Next.js</h1>
            </section>

            <section>
                <h1>One Route to rule them all</h1>

                <img class="" src="./graphics/express_route.svg" alt="" style="display: block; margin: 0 auto;">

                <aside class="notes">
                    <ul>
                      <li>Next.js -> datei-basiertes Routing ("pages" directory)</li>
                      <li>Alternativ: custom routing via Express-Server</li>
                      <li>"Catch-All"-Route mit zusätzlichem Parameter aus Regex</li>
                      <li>die Informationen werden anschließend zum Erzeugen eines API-Requests verwendet</li>
                    </ul>
                </aside>
            </section>

            <section>
                <h1>Generating API Requests</h1>

                <img class="" src="./graphics/request_builder.svg" alt="" style="display: block; margin: 0 auto; position: relative; top: -20px;">

                <aside class="notes">
                    <ul>
                      <li>"getInitialProps" -> Erklärung (Verweis auf "componentDidMount")</li>
                      <li>URL ist jetzt verfügbar als zusätzlicher Query param</li>
                      <li>Request Builder bekommt Next.js-Context und generiert Request-Konfiguration</li>
                      <li>Deterministischer Workflow -> leicht zu testen, v.a. der Request Builder</li>
                      <li>Sekundäre Daten (z.B. Warenkorb-Infos) aus Performance-Gründen erst auf dem Client</li>
                    </ul>
                </aside>
            </section>

            <section>
                <h1>Handling User Interaction</h1>

                <img class="" src="./graphics/form_submit.svg" alt="" style="display: block; margin: 0 auto;">

                <aside class="notes">
                    <ul>
                        <li>Nutzung des selben Mechanismus für User-Interaction</li>
                        <li>"Router.push" -> triggert getInitialProps</li>
                        <li>URL kann einfach geteilt werden</li>
                        <li>functions -> same input = same result -> pure functions</li>
                    </ul>
                </aside>
            </section>

            <section class="black-slide">
                <h1 class="presentation-title">The Migration Process</h1>
            </section>

            <section>
              <h5>Gradual Migration:</h5>

                <ol>
                  <li class="">Traffic gets routed to the Next.js server first</li>
                  <li class="fragment fade-opacity-in"><b>Feature Flag</b> - Next.js returns a non-200 status code, the load balancer falls back to the legacy system</li>
                    <li class="fragment fade-opacity-in">Enables <b>Page-by-Page</b> or <b>Type-by-Type</b> migration to the new Frontend application</li>
                </ol>

                <aside class="notes">
                    <ul>
                        <li>Failover als Feature-Flag</li>
                        <li>URl-Whitelist</li>
                        <li>erlaubt Monitoring von Performance oder SEO in einem eingegrenzten Rahmen</li>
                    </ul>
                </aside>
            </section>

<section class="black-slide">
                <h1 class="presentation-title">Lessons learned</h1>
            </section>

            <section>
                <h1>Native Browser APIs rule!</h1>

                <div class="custom-events-wrapper">
                    <figure class="fragment">
                        <figcaption>&#x3C;Overlay /&#x3E;</figcaption>
                        <img src="./graphics/custom_events_1.svg" alt="">
                    </figure>

                    <figure class="fragment">
                        <figcaption>&#x3C;OtherComponent /&#x3E;</figcaption>
                        <img src="./graphics/custom_events_2.svg" alt="">
                    </figure>
                </div>

                <aside class="notes">
                    <ul>
                        <li>State-Management als Hot-Topic</li>
                        <li>kein Bedarf an komplexen Lösungen wie Redux oder Mobx</li>
                        <li>Aber: Bedarf an "Cross-Component-Communication"</li>
                        <li>Lösung: Custom Events -> Komponenten sind selbstverantwortlich</li>
                    </ul>
                </aside>
            </section>

            <section>
                <h1>Integrating different Frameworks is haaard</h1>
                <h1 class="fragment">(...still evolving...)</h1>

                <aside class="notes">
                    <ul>
                        <li>Pattern-Library + Next.js = The dream?</li>
                        <li>Components -> super</li>
                        <li>Styles+Bilder+andere Assets -> eher nicht so gt</li>
                        <li>Constraints der verschiedenen Frameworks (z.B. "static"-directory in Next.js)</li>
                        <li>Verschiedene Ansätze: Mono-Repo vs. geteilte Repos</li>
                    </ul>
                </aside>
            </section>

            <section>
                <h1>Unofficial Web Standards</h1>

                <pre class="fragment language-javascript">
                  <code class="hljs javascript language-javascript" data-trim>
                    ?makairaFilter[color][0]=White&makairaFilter[color][1]=Violet
                  </code>
                </pre>

                <aside class="notes">
                    <ul>
                        <li>So, the job I'm currently working in is my first actual job after going to the university</li>
                        <li>Why am I telling you this?</li>
                        <li>Well, since this is my first job I don't have alot of deep knowledge in many of the programming languages on the web because we mostly rely on PHP and JavaScript</li>
                        <li>When I wanted to migrate this specific functionality of how the "old" application handled filters in the query params, it proved difficult to replicate the handling for this array syntax in JavaScript</li>
                        <li>So when I did some research around this problem, I did not find any mention about some kind of "standard" when it comes to handling these exmaples of nested query params</li>
                        <li>It actually feels like PHP somehow pushed this into the web as some kind of unofficial standard...</li>
                        <li>...and frameworks that came after had to roll their own implementation to support this syntax</li>
                        <li>I wanted to mention this point because at least to me it was new and surprising</li>
                        <li>So, how did we solve this issue?</li>
                        <li>of course, you could use your own implementation to parse the URL params in Javascript, but we solved this by using a small library called "qs"</li>
                        <li>Now, I want to note that to this day I'm still not sure if I might have been missing something here during my research and there might actually be way to handle these cases with node.js and express, so if i did - please come to me afterwards and tell me, but for now we have a solution that works pretty well for us</li>
                    </ul>
                </aside>
            </section>

            <section>
                <h1>Mind the Version Number!</h1>
                <aside class="notes">
                    <ul>
                        <li>Another lesson learned the hard way for me was this one</li>
                        <li>So, in the past I never really paid attention to the version of the packages I was using as long as they get the job done</li>
                        <li>building our application made me realize for the first time that you can quickly hit a wall if you are not careful about the libraries you use</li>
                        <li>To give an example: in React, there are a couple of popular libraries when it comes to internationalization</li>
                        <li>we were using a Next.js-adaption of a popular React-I18n library</li>
                        <li>the package was still pre version 1.0 and therefore changing quite rapidly</li>
                        <li>this caused us to experience 2 breaking changes, one of which we couldn't even debug properly because it only appeared in production and was not reproducable in any way on our local or staging machines</li>
                        <li>in the end we decided it was not worth the trouble and developed our own solution</li>
                        <li>the result might not be as sophisticated compared to all the features the library offered...</li>
                        <li>...in fact, its quite a simple solution...</li>
                        <li>...but it works perfectly for us with a relativly low compexity and we as a result we also have one less dependency to maintain</li>
                        <li>Aaaand that's it for now...</li>
                    </ul>
                </aside>
            </section>

            <section>
                <h1>Blog</h1>
                <h1 style="font-family: 'Barlow Medium'">www.lost-in-technology.com</h1>
                <aside class="notes">
                    <ul>
                      <li>last but not least I want to mention that I started my own blog this year</li>
                      <li>While the past couple of weeks have been quite busy, I plan to release 2 or 3 more posts until the end of the year</li>
                      <li>So, if you are interested in reading stuff around web development, please have a look and I would welcome any feedback very much</li>
                    </ul>
                </aside>
            </section>

            <section>
                <div class="hiring-wrapper">
                    <h1 style="text-transform: uppercase;">We are hiring!</h1>
                    <img class="footer__logo" src="./images/marmalade-logo-big.png" />
                </div>

                <aside class="notes">
                    <ul>
                    <li>Also, like every other tech company today, we are of course looking to hire new developers right now</li>
                    <li>So if you found the project and the talk interesting and would to like to work on similar projects, please come and talk to us</li>
                    </ul>
                </aside>
            </section>

            <section>
                <h1 style="text-transform: uppercase;">Thank <br> You</h1>

                <aside class="notes">
                    <ul></ul>
                </aside>
            </section>

        </div>

        <!-- <footer> -->
            <!-- <div class="footer__logos"> -->
                <!-- <img class="footer__logo" src="./images/marmalade-logo.jpg" /> -->
                <!-- <img class="footer__logo" src="./images/makaira-logo.jpg" /> -->
            <!-- </div> -->
            <!-- <div class="footer__personal"> -->
                <!-- <span class="footer__name">René Mäkeler</span> -->
                <!-- <span class="footer__name">2019</span> -->
            <!-- </div> -->
        <!-- </footer> -->
    </div>

    <script src="js/reveal.js"></script>

    <script>
        // More info about config & dependencies:
        // - https://github.com/hakimel/reveal.js#configuration
        // - https://github.com/hakimel/reveal.js#dependencies
        Reveal.initialize({
            dependencies: [{
                src: 'plugin/markdown/marked.js'
            }, {
                src: 'plugin/markdown/markdown.js'
            }, {
                src: 'plugin/notes/notes.js',
                async: true
            }, {
                src: 'plugin/highlight/highlight.js',
                async: true
            }]
        });
    </script>
</body>

</html>
